<!DOCTYPE>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=2">
    <title>aucatsvc</title>
    <style>
    .group {
	width: 100%;
    }
    label {
	display: inline-block;
	width: 100px;
    }
    </style>
    <script>
    function onchange() {
	var xmh = new XMLHttpRequest();
	xmh.onreadystatechange = function() {
	    if (xmh.readyState == 4 && xmh.status == 200) {
		success(xmh.responseText);
	    }
	};
	xmh.open('POST', '/aucat', true);
	xmh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	xmh.send("chan=" + this.id + "&vol=" + this.value);
    }
    function success(resp) {
    	var res, content, div, range, label;
	try {
	    res = JSON.parse(resp);
	} catch (error) {
	    return;
	}
	content = document.getElementById('content');
	res["chans"].forEach(function (v) {
	    range = document.getElementById(v['chan']);
	    if (range === null) {
		range = document.createElement('input');
		range.id = v['chan'];
		range.type = 'range';
		range.min = 0;
		range.max = 127;
		range.step = 1;
		range.onchange = onchange;
		label = document.createElement('label');
		label.htmlFor = range.id;
		label.appendChild(document.createTextNode(v['chan']));
		div = document.createElement('div');
		div.className = 'group';
		div.appendChild(label);
		div.appendChild(range);
		content.appendChild(div);
	    }
	    range.value = v['vol'];
	});
    }
    function refresh() {
    	var xmh = new XMLHttpRequest();
	xmh.onreadystatechange = function() {
	    if (xmh.readyState == 4 && xmh.status == 200) {
		success(xmh.responseText);
	    }
	};
	xmh.open('GET', '/aucat', true);
	xmh.send(null);
    }
    document.addEventListener('DOMContentLoaded', refresh);
    </script>
</head>
<body>
<div id="content">
</div>
</body>
</html>
